<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jhat.auth.dao.LoginLogDAO">
	
	<cache/>
	
	<insert id="addLoginLog" parameterType="org.jhat.auth.LoginLog" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO jhat_auth_log_user_login (user, login, address, type, status)
		VALUES(#{user}, #{login}, #{address}, #{type}, #{status})
	</insert>
	
	<sql id="restriction_loginLogs">
		<trim prefix="WHERE" prefixOverrides="AND">
			<if test="parameters != null">
				<if test="parameters.user != null">
					AND user LIKE CONCAT('%',#{parameters.user},'%')
				</if>
				<if test="parameters.login != null">
					AND login LIKE CONCAT(#{parameters.login},'%')
				</if>
				<if test="parameters.address != null">
					AND address LIKE CONCAT(#{parameters.address},'%')
				</if>
				<if test="parameters.type != null">
					AND type = #{parameters.type}
				</if>
				<if test="parameters.status != null">
					AND status = #{parameters.status}
				</if>
			</if>
		</trim>
	</sql>
	
	<select id="queryLoginLogs" resultType="org.jhat.auth.LoginLog" parameterType="org.jhat.common.query.QueryBase">
		SELECT * FROM jhat_auth_log_user_login
		<include refid="restriction_loginLogs"/>
		ORDER BY login
		<if test="_parameter != null">
			LIMIT #{firstRow}, #{maxRow}
		</if>
	</select>
	
	<select id="countLoginLogs" resultType="long" parameterType="org.jhat.common.query.QueryBase">
		SELECT COUNT(*) FROM jhat_auth_log_user_login
		<include refid="restriction_loginLogs"/>
	</select>
	
</mapper>
